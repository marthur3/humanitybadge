<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit DOM Structure Mock - Humanity Badge Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #dae0e6;
            margin: 0;
            padding: 20px;
        }
        
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            color: #1c1c1c;
            border-bottom: 2px solid #ff4500;
            padding-bottom: 10px;
        }
        
        /* New Reddit (Shreddit) Styles */
        shreddit-comment-composer {
            display: block;
            margin: 10px 0;
        }
        
        shreddit-post-composer {
            display: block;
            margin: 10px 0;
        }
        
        .comment-form-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        /* Old Reddit Styles */
        .usertext-edit {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
        }
        
        .Comment {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        
        /* Textarea Styles */
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: inherit;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            border-color: #0079d3;
            box-shadow: 0 0 0 2px rgba(0,121,211,0.2);
        }
        
        /* Contenteditable Styles */
        [contenteditable="true"] {
            min-height: 100px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
        }
        
        [contenteditable="true"]:focus {
            outline: none;
            border-color: #0079d3;
            box-shadow: 0 0 0 2px rgba(0,121,211,0.2);
        }
        
        /* Test Status */
        .test-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #0079d3;
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .test-passed {
            background: #46d160;
        }
        
        .test-failed {
            background: #ff4444;
        }
        
        /* Reddit-specific test elements */
        .post-container {
            background: white;
            border-radius: 8px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .comment-tree {
            margin-left: 20px;
        }
        
        .comment-reply {
            margin-left: 40px;
            border-left: 2px solid #ddd;
            padding-left: 10px;
        }
    </style>
</head>
<body>
    <div class="test-status" id="testStatus">Loading Extension...</div>
    
    <h1>🧪 Reddit DOM Structure Mock for Humanity Badge Testing</h1>
    <p>This page simulates various Reddit DOM structures to test the Humanity Badge extension.</p>
    
    <!-- New Reddit (Shreddit) Comment Composer -->
    <div class="test-section">
        <h2>New Reddit Comment Composer (Shreddit)</h2>
        <shreddit-comment-composer>
            <div class="comment-form-container">
                <textarea placeholder="What are your thoughts?" 
                         data-testid="comment-submission-form-richtext"
                         rows="4"></textarea>
            </div>
        </shreddit-comment-composer>
    </div>
    
    <!-- New Reddit Post Composer -->
    <div class="test-section">
        <h2>New Reddit Post Composer</h2>
        <shreddit-post-composer>
            <div class="comment-form-container">
                <textarea placeholder="Write your post..." rows="6"></textarea>
            </div>
        </shreddit-post-composer>
    </div>
    
    <!-- Reddit UserText Component -->
    <div class="test-section">
        <h2>Reddit UserText Component</h2>
        <div data-testid="UserText">
            <textarea placeholder="Add a comment..." rows="4"></textarea>
        </div>
    </div>
    
    <!-- Reddit Comment Form -->
    <div class="test-section">
        <h2>Reddit Comment Form</h2>
        <div class="Comment">
            <form>
                <textarea placeholder="Reply to this comment..." rows="3"></textarea>
                <div style="margin-top: 10px;">
                    <button type="submit">Reply</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Comment Composer with Slot -->
    <div class="test-section">
        <h2>Comment Composer with Slot</h2>
        <div data-slot-rendered-by="comment_composer">
            <textarea placeholder="Join the conversation..." rows="4"></textarea>
        </div>
    </div>
    
    <!-- Old Reddit Style -->
    <div class="test-section">
        <h2>Old Reddit Style (.usertext-edit)</h2>
        <div class="usertext-edit">
            <textarea name="text" placeholder="markdown supported" rows="4"></textarea>
        </div>
    </div>
    
    <!-- ContentEditable Elements -->
    <div class="test-section">
        <h2>ContentEditable Elements</h2>
        <div contenteditable="true" data-placeholder="Type your message here...">
            Click here to start typing...
        </div>
    </div>
    
    <!-- Mixed Form Elements -->
    <div class="test-section">
        <h2>Mixed Form Elements</h2>
        <textarea placeholder="Regular textarea" rows="3"></textarea>
        <br><br>
        <input type="text" placeholder="Text input field" style="width: 100%; padding: 8px;">
        <br><br>
        <div contenteditable="true" style="border: 1px solid #ccc; padding: 8px; min-height: 60px;">
            ContentEditable div
        </div>
    </div>
    
    <!-- Nested Comment Structure -->
    <div class="test-section">
        <h2>Nested Comment Structure</h2>
        <div class="post-container">
            <div class="comment-tree">
                <div class="Comment">
                    <p>Top-level comment</p>
                    <form>
                        <textarea placeholder="Reply..." rows="2"></textarea>
                    </form>
                    
                    <div class="comment-reply">
                        <div class="Comment">
                            <p>Nested reply</p>
                            <form>
                                <textarea placeholder="Reply..." rows="2"></textarea>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Dynamic Content Test -->
    <div class="test-section">
        <h2>Dynamic Content Test</h2>
        <button onclick="addDynamicTextarea()">Add Dynamic Textarea</button>
        <div id="dynamicContainer"></div>
    </div>
    
    <!-- Edge Cases -->
    <div class="test-section">
        <h2>Edge Cases</h2>
        
        <h3>Hidden Elements</h3>
        <textarea style="display: none;" placeholder="Hidden textarea"></textarea>
        
        <h3>Very Small Elements</h3>
        <textarea style="width: 10px; height: 10px;" placeholder="Tiny"></textarea>
        
        <h3>Disabled Elements</h3>
        <textarea disabled placeholder="Disabled textarea"></textarea>
        
        <h3>Read-only Elements</h3>
        <textarea readonly value="Read-only content"></textarea>
        
        <h3>No Dimensions</h3>
        <textarea style="width: 0; height: 0;" placeholder="No dimensions"></textarea>
    </div>
    
    <script>
        // Test JavaScript
        let testResults = {
            extensionLoaded: false,
            buttonsAttached: 0,
            eventsWorking: false,
            pasteBlocked: false,
            recordingWorks: false
        };
        
        function updateTestStatus() {
            const status = document.getElementById('testStatus');
            const passed = Object.values(testResults).filter(v => v === true).length + 
                          (testResults.buttonsAttached > 0 ? 1 : 0);
            const total = Object.keys(testResults).length;
            
            status.textContent = `Tests: ${passed}/${total} passed`;
            status.className = 'test-status ' + (passed === total ? 'test-passed' : 'test-failed');
        }
        
        function addDynamicTextarea() {
            const container = document.getElementById('dynamicContainer');
            const textarea = document.createElement('textarea');
            textarea.placeholder = 'Dynamic textarea ' + (container.children.length + 1);
            textarea.rows = 3;
            container.appendChild(textarea);
            
            // Give the extension time to detect the new element
            setTimeout(() => {
                checkForButtons();
            }, 200);
        }
        
        function checkForButtons() {
            const buttons = document.querySelectorAll('.typing-record-btn');
            testResults.buttonsAttached = buttons.length;
            testResults.extensionLoaded = buttons.length > 0;
            updateTestStatus();
        }
        
        function testPastePrevention() {
            const textareas = document.querySelectorAll('textarea');
            if (textareas.length > 0) {
                const textarea = textareas[0];
                
                // Simulate paste event
                const pasteEvent = new Event('paste', {
                    bubbles: true,
                    cancelable: true
                });
                
                let defaultPrevented = false;
                pasteEvent.preventDefault = () => {
                    defaultPrevented = true;
                };
                
                textarea.dispatchEvent(pasteEvent);
                testResults.pasteBlocked = defaultPrevented;
                updateTestStatus();
            }
        }
        
        // Monitor for extension loading
        let checkCount = 0;
        const extensionCheck = setInterval(() => {
            checkForButtons();
            checkCount++;
            
            if (testResults.extensionLoaded || checkCount > 50) {
                clearInterval(extensionCheck);
                
                if (testResults.extensionLoaded) {
                    console.log('✅ Extension detected!');
                    
                    // Run additional tests
                    setTimeout(() => {
                        testPastePrevention();
                    }, 500);
                } else {
                    console.log('❌ Extension not detected after 10 seconds');
                    updateTestStatus();
                }
            }
        }, 200);
        
        // Test for Reddit domain detection
        console.log('Current hostname:', window.location.hostname);
        console.log('Should be detected as Reddit:', window.location.hostname.includes('reddit'));
        
        // Simulate Reddit's dynamic loading
        setTimeout(() => {
            const event = new Event('DOMContentLoaded');
            document.dispatchEvent(event);
        }, 100);
        
        // Test console logging
        console.log('🧪 Reddit DOM Mock loaded');
        console.log('Available textareas:', document.querySelectorAll('textarea').length);
        console.log('Available contenteditable:', document.querySelectorAll('[contenteditable="true"]').length);
        
        updateTestStatus();
    </script>
</body>
</html>